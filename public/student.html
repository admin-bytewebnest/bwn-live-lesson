<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BYTEWEBNEST · Student</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

<style>
:root {
  --bg-main: #0b0814;
  --bg-panel: rgba(255,255,255,0.03);
  --border-glass: rgba(255,255,255,0.08);
  --neon: #7b2ff7;
  --neon-soft: rgba(123,47,247,.35);
  --text-main: #f5f3ff;
  --text-muted: #a89ecb;
}

* {
  box-sizing: border-box;
}

body {
  margin:0;
  min-height:100vh;
  background:
    radial-gradient(1200px 600px at 20% -10%, rgba(123,47,247,.15), transparent 60%),
    radial-gradient(800px 500px at 90% 10%, rgba(192,155,255,.08), transparent 60%),
    var(--bg-main);
  color:var(--text-main);
  font-family: system-ui, -apple-system, Segoe UI, sans-serif;
}

/* ===== HEADER ===== */
header {
  padding:18px 20px;
  text-align:center;
  font-weight:600;
  letter-spacing:.6px;
  font-size:18px;
  background:linear-gradient(90deg, #7b2ff7, #c09bff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* ===== TOP BAR ===== */
.controls {
  display:flex;
  justify-content:center;
  align-items:center;
  gap:14px;
  padding:10px 0 6px;
}

.controls span {
  font-size:13px;
  color:var(--text-muted);
}

.controls button {
  width:38px;
  height:38px;
  border-radius:10px;
  border:1px solid var(--border-glass);
  background:var(--bg-panel);
  color:var(--text-main);
  font-size:18px;
  cursor:pointer;
  transition:.25s;
  box-shadow:
    inset 0 0 0 1px rgba(255,255,255,.02),
    0 0 0 rgba(123,47,247,0);
}

.controls button:hover {
  border-color:var(--neon);
  box-shadow:0 0 18px var(--neon-soft);
  color:#fff;
}

/* ===== LAYOUT ===== */
.grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  padding:14px;
}

@media (max-width: 900px) {
  .grid {
    grid-template-columns:1fr;
  }
}

/* ===== PANELS ===== */
.panel {
  background:var(--bg-panel);
  border:1px solid var(--border-glass);
  border-radius:14px;
  overflow:hidden;
  backdrop-filter: blur(12px);
  box-shadow:
    0 10px 40px rgba(0,0,0,.45),
    inset 0 0 0 1px rgba(255,255,255,.02);
}

/* ===== CODEMIRROR ===== */
.CodeMirror {
  height:70vh;
  background:transparent;
  font-size:14px;
}

.CodeMirror-gutters {
  background:transparent;
  border-right:1px solid rgba(255,255,255,.05);
}

.CodeMirror-linenumber {
  color:#6f63a6;
}

/* ===== PREVIEW ===== */
iframe {
  width:100%;
  height:70vh;
  border:none;
  background:#000;
}

/* ===== FOOT NOTE ===== */
.footer-note {
  text-align:center;
  font-size:11px;
  color:#6d639a;
  padding:6px 0 12px;
  opacity:.7;
}
</style>
</head>

<body>

<header>BYTEWEBNEST · Live Lesson · Student</header>

<div class="controls">
  <button id="fontMinus">−</button>
  <span>Размер кода</span>
  <button id="fontPlus">+</button>
</div>

<div class="grid">
  <div class="panel">
    <textarea id="code"></textarea>
  </div>

  <div class="panel">
    <iframe id="preview"></iframe>
  </div>
</div>

<div class="footer-note">
  When conversation matters · BYTEWEBNEST CONNECT
</div>

<script>
const previewFrame = document.getElementById("preview")

const baseFontSize = 14
let currentFontSize = baseFontSize

const codeMirror = CodeMirror.fromTextArea(
  document.getElementById("code"),
  {
    mode:"htmlmixed",
    theme:"material-darker",
    lineNumbers:true,
    readOnly:true,
    cursorBlinkRate:0
  }
)

function applyFontSize() {
  codeMirror.getWrapperElement().style.fontSize = currentFontSize + "px"
  codeMirror.refresh()
}
applyFontSize()

fontPlus.onclick = () => {
  currentFontSize += 2
  applyFontSize()
}
fontMinus.onclick = () => {
  if(currentFontSize > baseFontSize){
    currentFontSize -= 2
    applyFontSize()
  }
}

const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

ws.onopen = () => {
  ws.send(JSON.stringify({
    type:"subscribe",
    lessonId:"lesson-1"
  }))
}

ws.onmessage = e => {
  const msg = JSON.parse(e.data)

  if(msg.type === "update"){
    codeMirror.setValue(msg.html)
    previewFrame.srcdoc = msg.html
    applyFontSize()
  }

  if(msg.type === "cursor"){
    codeMirror.setSelection(msg.from, msg.to)
    codeMirror.scrollIntoView(msg.from, 120)
  }
}
</script>

</body>
</html>
