<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BYTEWEBNEST · Student</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

<style>
body { margin:0; background:#0f0a1a; color:#fff; font-family:system-ui }
header {
  padding:14px; text-align:center; font-weight:bold;
  background:linear-gradient(90deg,#7b2ff7,#c09bff);
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
}
.grid {
  display:grid; grid-template-columns:1fr 1fr;
  gap:10px; padding:10px;
}
iframe, .CodeMirror {
  height:70vh; border-radius:10px;
  border:2px solid #7b2ff7;
}
</style>
</head>

<body>
<header>BYTEWEBNEST · Live Lesson · Student</header>

<div class="grid">
  <textarea id="code"></textarea>
  <iframe id="preview"></iframe>
</div>

<script>
const editor = CodeMirror.fromTextArea(document.getElementById("code"), {
  mode:"htmlmixed",
  theme:"material-darker",
  readOnly:true,
  lineNumbers:true,
  cursorBlinkRate:0
})

const preview = document.getElementById("preview")
const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

ws.onopen = () =>
  ws.send(JSON.stringify({ type:"subscribe", lessonId:"lesson-1" }))

ws.onmessage = e => {
  const msg = JSON.parse(e.data)

  if(msg.type==="update"){
    editor.setValue(msg.html)
    preview.srcdoc = msg.html
  }

  if(msg.type==="cursor"){
    editor.setSelections([{ anchor:msg.from, head:msg.to }])
    editor.scrollIntoView({ line:msg.to.line, ch:0 }, 100)
  }
}
</script>
</body>
</html>
