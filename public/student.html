<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BYTEWEBNEST · Live Lesson · Student</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

<style>
:root {
  --bg-main: #0b0714;
  --bg-panel: rgba(20, 12, 35, 0.75);
  --accent: #7b2ff7;
  --accent-soft: #c09bff;
  --border-soft: rgba(123, 47, 247, 0.35);
}

* {
  box-sizing: border-box;
}

body {
  margin: 0;
  height: 100vh;
  background:
    radial-gradient(1200px 600px at 10% -10%, rgba(123,47,247,0.15), transparent),
    radial-gradient(800px 400px at 90% 10%, rgba(192,155,255,0.12), transparent),
    var(--bg-main);
  color: #fff;
  font-family: system-ui, -apple-system, BlinkMacSystemFont;
  overflow: hidden;
}

/* ===== TOP BAR ===== */
.header {
  position: sticky;
  top: 0;
  z-index: 10;
  height: 56px;
  display: grid;
  grid-template-columns: 1fr 1fr 1fr 1fr;
  align-items: center;
  padding: 0 16px;
  background: var(--bg-panel);
  backdrop-filter: blur(14px);
  border-bottom: 1px solid var(--border-soft);
}

.header-title {
  font-weight: 600;
  letter-spacing: 0.4px;
  background: linear-gradient(90deg, var(--accent), var(--accent-soft));
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;

  grid-column: 1 /2;
}

.controls {
  display: flex;
  gap: 8px;
  grid-column: 2 / 3;
}

.controls button {
  width: 36px;
  height: 36px;
  border-radius: 10px;
  border: 1px solid var(--border-soft);
  background: rgba(123,47,247,0.12);
  color: var(--accent-soft);
  font-size: 18px;
  cursor: pointer;
  transition: all .2s ease;
}

.controls button:hover {
  background: var(--accent);
  color: #fff;
}

/* ===== MAIN LAYOUT ===== */
.main {
  height: calc(100vh - 56px);
  display: grid;
  grid-template-columns: 1fr 1fr;
}

/* ===== CODE ===== */
.code-wrap {
  border-right: 1px solid var(--border-soft);
  background: rgba(10,6,18,0.9);
}

.CodeMirror {
  height: 100%;
  font-size: 14px;
}

/* ===== PREVIEW ===== */
.preview-wrap {
  background: #000;
}

.preview-wrap iframe {
  width: 100%;
  height: 100%;
  border: none;
}
</style>
</head>

<body>

<!-- HEADER -->
<div class="header">
  <div class="header-title">BYTEWEBNEST · Live Lesson</div>
  <div class="controls">
    <button id="fontMinus">−</button>
    <button id="fontPlus">+</button>
  </div>
</div>

<!-- MAIN -->
<div class="main">
  <div class="code-wrap">
    <textarea id="code"></textarea>
  </div>

  <div class="preview-wrap">
    <iframe id="preview"></iframe>
  </div>
</div>

<script>
const previewFrame = document.getElementById("preview")

const baseFontSize = 14
let currentFontSize = baseFontSize

const codeMirror = CodeMirror.fromTextArea(
  document.getElementById("code"),
  {
    mode: "htmlmixed",
    theme: "material-darker",
    lineNumbers: true,
    readOnly: true,
    cursorBlinkRate: 0
  }
)

function applyFontSize() {
  codeMirror.getWrapperElement().style.fontSize = currentFontSize + "px"
  codeMirror.refresh()
}

applyFontSize()

fontPlus.onclick = () => {
  currentFontSize += 2
  applyFontSize()
}

fontMinus.onclick = () => {
  if (currentFontSize > baseFontSize) {
    currentFontSize -= 2
    applyFontSize()
  }
}

const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

ws.onopen = () => {
  ws.send(JSON.stringify({
    type: "subscribe",
    lessonId: "lesson-1"
  }))
}

ws.onmessage = e => {
  const msg = JSON.parse(e.data)

  if (msg.type === "update") {
    codeMirror.setValue(msg.html)
    previewFrame.srcdoc = msg.html
    applyFontSize()
  }

  if (msg.type === "cursor") {
    codeMirror.setSelection(msg.from, msg.to)
    codeMirror.scrollIntoView(msg.from, 100)
  }
}
</script>

</body>
</html>
