<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BYTEWEBNEST · Student</title>

<style>
body {
  margin:0;
  background:#0f0a1a;
  color:#fff;
  font-family:system-ui;
}
header {
  padding:14px;
  text-align:center;
  font-weight:bold;
  background:linear-gradient(90deg,#7b2ff7,#c09bff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}
.controls {
  display:flex;
  justify-content:center;
  gap:10px;
}
.controls button {
  width:36px;
  height:36px;
  border:1px solid #7b2ff7;
  background:#1a102a;
  color:#c09bff;
  cursor:pointer;
}
.grid {
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:10px;
  padding:10px;
}
iframe {
  width:100%;
  height:70vh;
  border:2px solid #7b2ff7;
  border-radius:10px;
}
</style>
</head>

<body>
<header>BYTEWEBNEST · Live Lesson · Student</header>

<div class="controls">
  <button id="fontMinus">−</button>
  <span>Размер кода</span>
  <button id="fontPlus">+</button>
</div>

<div class="grid">
  <iframe id="code"></iframe>
  <iframe id="preview"></iframe>
</div>

<script>
const codeFrame = document.getElementById("code")
const previewFrame = document.getElementById("preview")
const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

let baseFontSize = 14
let fontSize = baseFontSize
let lastHTML = ""

function escapeHtml(s) {
  return s
    .replace(/&/g,"&amp;")
    .replace(/</g,"&lt;")
    .replace(/>/g,"&gt;")
}

function renderCode(from=null, to=null) {
  const lines = lastHTML.split("\n")
  const html = lines.map((l,i)=>{
    if (from!==null && i>=from && i<=to) {
      return `<div style="background:rgba(123,47,247,.25)">${escapeHtml(l)}</div>`
    }
    return `<div>${escapeHtml(l)}</div>`
  }).join("")

  codeFrame.srcdoc = `
    <pre style="color:#e8e0ff;font-size:${fontSize}px;padding:10px">
${html}
    </pre>
  `
}

ws.onopen = () => {
  ws.send(JSON.stringify({
    type:"subscribe",
    lessonId:"lesson-1"
  }))
}

ws.onmessage = e => {
  const msg = JSON.parse(e.data)

  if (msg.type==="update") {
    lastHTML = msg.html
    renderCode()
    previewFrame.srcdoc = lastHTML
  }

  if (msg.type==="cursor") {
    renderCode(msg.from.line, msg.to.line)
  }
}

fontPlus.onclick = () => {
  fontSize += 2
  renderCode()
}

fontMinus.onclick = () => {
  if (fontSize > baseFontSize) {
    fontSize -= 2
    renderCode()
  }
}
</script>
</body>
</html>
