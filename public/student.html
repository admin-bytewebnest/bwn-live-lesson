<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>BYTEWEBNEST · Student</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>

<style>
:root {
  --bg-main:#0b0714;
  --panel-bg:rgba(20,12,35,.75);
  --panel-border:rgba(123,47,247,.35);
  --accent:#7b2ff7;
  --accent-soft:rgba(123,47,247,.25);
  --text-soft:#c9bfff;
}

* { box-sizing:border-box; }

body {
  margin:0;
  height:100vh;
  background:
    radial-gradient(circle at top,#1a1033,#0b0714 70%);
  color:#fff;
  font-family:system-ui;
  overflow:hidden;
}

/* HEADER */
header {
  height:56px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:600;
  letter-spacing:.5px;
  background:linear-gradient(90deg,var(--accent),#c09bff);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
}

/* LAYOUT */
.workspace {
  height:calc(100vh - 56px);
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:12px;
  padding:12px;
}

/* PANELS */
.panel {
  background:var(--panel-bg);
  border:1px solid var(--panel-border);
  border-radius:16px;
  backdrop-filter:blur(14px);
  box-shadow:
    0 0 0 1px rgba(255,255,255,.03),
    0 20px 40px rgba(0,0,0,.6);
  display:flex;
  flex-direction:column;
  overflow:hidden;
}

/* PANEL HEADER */
.panel-title {
  padding:10px 14px;
  font-size:13px;
  text-transform:uppercase;
  letter-spacing:1px;
  color:var(--text-soft);
  border-bottom:1px solid rgba(255,255,255,.05);
  background:linear-gradient(180deg,rgba(255,255,255,.04),transparent);
}

/* CODEMIRROR */
.CodeMirror {
  flex:1;
  font-size:14px;
  background:transparent;
}

/* PREVIEW */
iframe {
  flex:1;
  border:none;
  background:#000;
}

/* FLOAT CONTROLS */
.controls {
  position:absolute;
  top:70px;
  left:50%;
  transform:translateX(-50%);
  display:flex;
  gap:8px;
  background:rgba(15,10,25,.8);
  border:1px solid var(--panel-border);
  border-radius:14px;
  padding:6px 10px;
  backdrop-filter:blur(12px);
}

.controls button {
  width:34px;
  height:34px;
  border-radius:10px;
  border:1px solid var(--panel-border);
  background:rgba(123,47,247,.15);
  color:#fff;
  font-size:18px;
  cursor:pointer;
}

.controls button:hover {
  background:var(--accent);
}

.controls span {
  display:flex;
  align-items:center;
  font-size:13px;
  opacity:.7;
}

/* RESPONSIVE */
@media (max-width:900px) {
  .workspace {
    grid-template-columns:1fr;
  }
}
</style>
</head>

<body>

<header>BYTEWEBNEST · Live Lesson · Student</header>

<div class="controls">
  <button id="fontMinus">−</button>
  <span>Code size</span>
  <button id="fontPlus">+</button>
</div>

<div class="workspace">
  <div class="panel">
    <div class="panel-title">Live Code</div>
    <textarea id="code"></textarea>
  </div>

  <div class="panel">
    <div class="panel-title">Live Result</div>
    <iframe id="preview"></iframe>
  </div>
</div>

<script>
const previewFrame = document.getElementById("preview")

const baseFontSize = 14
let currentFontSize = baseFontSize

const codeMirror = CodeMirror.fromTextArea(
  document.getElementById("code"),
  {
    mode:"htmlmixed",
    theme:"material-darker",
    lineNumbers:true,
    readOnly:true,
    cursorBlinkRate:0
  }
)

function applyFontSize(){
  codeMirror.getWrapperElement().style.fontSize = currentFontSize + "px"
  codeMirror.refresh()
}
applyFontSize()

fontPlus.onclick = ()=>{ currentFontSize+=2; applyFontSize() }
fontMinus.onclick = ()=>{
  if(currentFontSize>baseFontSize){
    currentFontSize-=2; applyFontSize()
  }
}

const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

ws.onopen = ()=>{
  ws.send(JSON.stringify({ type:"subscribe", lessonId:"lesson-1" }))
}

ws.onmessage = e=>{
  const msg = JSON.parse(e.data)

  if(msg.type==="update"){
    codeMirror.setValue(msg.html)
    previewFrame.srcdoc = msg.html
    applyFontSize()
  }

  if(msg.type==="cursor"){
    codeMirror.setSelection(msg.from,msg.to)
    codeMirror.scrollIntoView(msg.from,100)
  }
}
</script>

</body>
</html>
