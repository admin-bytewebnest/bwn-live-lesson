<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8" />
  <title>BYTEWEBNEST · Live Lesson</title>
  <style>
    body {
      margin:0;
      background:#0f0a1a;
      color:white;
      font-family: system-ui;
    }
    h1 {
      text-align:center;
      padding:15px;
      color:white;
    }
    .grid {
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:15px;
      padding:15px;
    }
    iframe {
      width:100%;
      height:70vh;
      background:#0b0616;
      border:2px solid #7b2ff7;
      border-radius:10px;
      color: white;
    }
    @media (max-width:800px){
      .grid { grid-template-columns:1fr; }
    }
  </style>
</head>
<body>

<h1>BYTEWEBNEST · Live Lesson</h1>

<div class="grid">
  <iframe id="code"></iframe>
  <iframe id="preview"></iframe>
</div>

<script>
  const ws = new WebSocket("wss://bwn-live-lesson.onrender.com");
  const codeFrame = document.getElementById("code");
  const previewFrame = document.getElementById("preview");

  const escapeHTML = (str) =>
    str.replace(/&/g,"&amp;")
       .replace(/</g,"&lt;")
       .replace(/>/g,"&gt;");

  ws.onopen = () => {
    ws.send(JSON.stringify({
      type: "subscribe",
      lessonId: "lesson-1"
    }));
  };

  ws.onmessage = (e) => {
    const msg = JSON.parse(e.data);
    if (msg.type !== "update") return;

    // ЛЕВО — код
    codeFrame.srcdoc = `
      <pre style="
        color:#e8e0ff;
        padding:15px;
        white-space:pre-wrap;
        font-family:monospace;
      ">${escapeHTML(msg.html)}</pre>
    `;

    // ПРАВО — результат
    previewFrame.srcdoc = msg.html;
  };
</script>

</body>
</html>
