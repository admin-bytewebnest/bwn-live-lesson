<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>BYTEWEBNEST · Student</title>

  <style>
    body {
      margin: 0;
      background: #0f0a1a;
      color: #fff;
      font-family: system-ui
    }

    header {
      padding: 14px;
      text-align: center;
      font-weight: bold;
      background: linear-gradient(90deg, #7b2ff7, #c09bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 10px
    }

    button {
      width: 36px;
      height: 36px;
      background: #1a102a;
      border: 1px solid #7b2ff7;
      color: #c09bff;
      border-radius: 8px
    }

    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      padding: 10px
    }

    iframe {
      width: 100%;
      height: 70vh;
      border: 2px solid #7b2ff7;
      border-radius: 10px
    }

    mark {
      background: #7b2ff755
    }

    @media(max-width:900px) {
      .grid {
        grid-template-columns: 1fr
      }
    }
  </style>
</head>

<body>
  <header>BYTEWEBNEST · Live Lesson · Student</header>

  <div class="controls">
    <button id="minus">−</button>
    <button id="plus">+</button>
  </div>

  <div class="grid">
    <iframe id="code"></iframe>
    <iframe id="preview"></iframe>
  </div>

  <script>
    const ws = new WebSocket(`wss://${location.host}`)
    const code = document.getElementById("code")
    const preview = document.getElementById("preview")

    let font = 14
    let html = ""
    let selection = null

    function render() {
      let lines = escape(html).split("\n")

      if (selection && selection[0]) {
        const a = selection[0].anchor.line
        const h = selection[0].head.line
        for (let i = Math.min(a, h); i <= Math.max(a, h); i++) {
          lines[i] = `<mark>${lines[i]}</mark>`
        }
      }

      code.srcdoc = `<pre style="font-size:${font}px">${lines.join("\n")}</pre>`
      preview.srcdoc = html
    }

    ws.onopen = () => ws.send(JSON.stringify({ type: "subscribe", lessonId: "lesson-1" }))

    ws.onmessage = e => {
      const m = JSON.parse(e.data)
      if (m.type === "update") { html = m.html; render() }
      if (m.type === "cursor") { selection = m.selections; render() }
    }

    plus.onclick = () => { font += 2; render() }
    minus.onclick = () => { if (font > 14) { font -= 2; render() } }

    function escape(s) {
      return s.replace(/&/g, "&amp;").replace(/</g, "&lt;").replace(/>/g, "&gt;")
    }
  </script>
</body>

</html>