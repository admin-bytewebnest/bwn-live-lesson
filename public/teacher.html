<!DOCTYPE html>
<html lang="ru">

<head>
  <meta charset="UTF-8">
  <title>BYTEWEBNEST Â· Teacher</title>

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">

  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closetag.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>

  <style>
    body {
      margin: 0;
      background: #0f0a1a;
      color: #fff;
      font-family: system-ui
    }

    header {
      padding: 14px;
      text-align: center;
      font-weight: bold;
      background: linear-gradient(90deg, #7b2ff7, #c09bff);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent
    }

    .CodeMirror {
      height: 65vh;
      border-radius: 10px
    }

    button {
      width: 100%;
      margin-top: 10px;
      padding: 14px;
      background: #7b2ff7;
      border: 0;
      border-radius: 10px;
      color: #fff
    }
  </style>
</head>

<body>
  <header>BYTEWEBNEST Â· Live Lesson Â· Teacher</header>

  <textarea id="editor">
<!DOCTYPE html>
<html>
<body>
<h1>Hello BYTEWEBNEST</h1>
<p>Live coding ðŸš€</p>
</body>
</html>
</textarea>

  <button id="publish">ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒ (Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ)</button>

  <script>
    const editor = CodeMirror.fromTextArea(editor, {
      mode: "htmlmixed",
      theme: "material-darker",
      lineNumbers: true,
      autoCloseTags: true,
      autoCloseBrackets: true
    })

    const ws = new WebSocket(`wss://${location.host}`)

    // Ð°Ð²Ñ‚Ð¾-Ð¿ÑƒÐ±Ð»Ð¸ÐºÐ°Ñ†Ð¸Ñ
    let timer
    editor.on("change", () => {
      clearTimeout(timer)
      timer = setTimeout(publish, 250)
    })

    // ÐºÑƒÑ€ÑÐ¾Ñ€ Ð¸ Ð²Ñ‹Ð´ÐµÐ»ÐµÐ½Ð¸Ðµ
    editor.on("cursorActivity", () => {
      ws.send(JSON.stringify({
        type: "cursor",
        lessonId: "lesson-1",
        selections: editor.listSelections()
      }))
    })

    function publish() {
      if (ws.readyState !== 1) return
      ws.send(JSON.stringify({
        type: "publish",
        lessonId: "lesson-1",
        key: "bwn-live-2025",
        html: editor.getValue()
      }))
    }

    publishBtn.onclick = publish
  </script>
</body>

</html>