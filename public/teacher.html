<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>BYTEWEBNEST Â· Teacher</title>

<!-- CodeMirror -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/theme/material-darker.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/codemirror.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/xml/xml.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/css/css.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/mode/htmlmixed/htmlmixed.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closetag.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/edit/closebrackets.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/show-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/html-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/css-hint.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/codemirror/5.65.16/addon/hint/xml-hint.min.js"></script>

<style>
body {
  margin: 0;
  background: #0f0a1a;
  color: #fff;
  font-family: system-ui;
}
header {
  padding: 14px;
  text-align: center;
  font-weight: bold;
  background: linear-gradient(90deg, #7b2ff7, #c09bff);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  font-size: 20px;
}
.editor-wrap { padding: 12px; }
.CodeMirror {
  height: 60vh;
  font-size: 15px;
  border-radius: 10px;
}
button {
  margin-top: 12px;
  width: 100%;
  padding: 14px;
  font-size: 16px;
  background: #7b2ff7;
  border: none;
  border-radius: 10px;
  color: white;
  cursor: pointer;
}
button:hover { background: #9f6bff; }
</style>
</head>

<body>
<header>BYTEWEBNEST Â· Live Lesson Â· Teacher</header>

<div class="editor-wrap">
<textarea id="editor">
<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>Demo</title>
<style>
body { background:#111; color:#fff; font-family:Arial; }
h1 { color:#7b2ff7; }
</style>
</head>
<body>

<h1>Hello BYTEWEBNEST</h1>
<p>Live coding Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚ ðŸš€</p>

</body>
</html>
</textarea>

<button id="publish">ÐžÐ¿ÑƒÐ±Ð»Ð¸ÐºÐ¾Ð²Ð°Ñ‚ÑŒ ÐºÐ¾Ð´ (Ð²Ñ€ÑƒÑ‡Ð½ÑƒÑŽ)</button>
</div>

<script>
const editor = CodeMirror.fromTextArea(document.getElementById("editor"), {
  mode: "htmlmixed",
  theme: "material-darker",
  lineNumbers: true,
  autoCloseTags: true,
  autoCloseBrackets: true,
  extraKeys: {
    "Ctrl-Space": "autocomplete",
    "Tab": cm => cm.replaceSelection("  ")
  }
})

// Ð¿Ð¾Ð´ÑÐºÐ°Ð·ÐºÐ¸
editor.on("inputRead", (cm, change) => {
  if (change.text[0].match(/[\w<]/) && !cm.state.completionActive) {
    cm.showHint({ completeSingle: false })
  }
})

const ws = new WebSocket("wss://bwn-live-lesson.onrender.com")

function debounce(fn, delay = 250) {
  let t
  return (...a) => {
    clearTimeout(t)
    t = setTimeout(() => fn(...a), delay)
  }
}

const autoPublish = debounce(() => {
  if (ws.readyState !== WebSocket.OPEN) return
  ws.send(JSON.stringify({
    type: "publish",
    lessonId: "lesson-1",
    key: "bwn-live-2025",
    html: editor.getValue()
  }))
}, 250)

// LIVE HTML
editor.on("change", autoPublish)

// ðŸ”´ ÐšÐ£Ð Ð¡ÐžÐ  / Ð’Ð«Ð”Ð•Ð›Ð•ÐÐ˜Ð•
editor.on("cursorActivity", () => {
  const sel = editor.listSelections()[0]
  if (!sel || ws.readyState !== WebSocket.OPEN) return

  ws.send(JSON.stringify({
    type: "cursor",
    lessonId: "lesson-1",
    from: sel.anchor,
    to: sel.head
  }))
})

// Ñ€ÑƒÑ‡Ð½Ð°Ñ ÐºÐ½Ð¾Ð¿ÐºÐ°
document.getElementById("publish").onclick = () => autoPublish()
</script>
</body>
</html>
